


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Material Design theme for MkDocs">
      
      
        <link rel="canonical" href="https://creme-ml.github.io/examples/the-art-of-using-pipelines/">
      
      
        <meta name="author" content="The creme developers">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>The art of using pipelines - creme</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4dd2dd8d.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.6a5ad368.min.css">
      
      
        
        
        <meta name="theme-color" content="#4051b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../css/version-select.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-63302552-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-art-of-using-pipelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://creme-ml.github.io/" title="creme" class="md-header-nav__button md-logo" aria-label="creme">
      
  <img src="../../img/creme_square.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            creme
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              The art of using pipelines
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/creme-ml/creme/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    creme-ml/creme
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Welcome
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../user-guide/reading-data/" class="md-tabs__link">
          User guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../api/overview/" class="md-tabs__link">
          API reference
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../batch-to-online/" class="md-tabs__link md-tabs__link--active">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../releases/0.0.2/" class="md-tabs__link">
          Releases
        </a>
      
    </li>
  

      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://creme-ml.github.io/" title="creme" class="md-nav__button md-logo" aria-label="creme">
      
  <img src="../../img/creme_square.svg" alt="logo">

    </a>
    creme
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/creme-ml/creme/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    creme-ml/creme
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      User guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User guide" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/reading-data/" title="Reading data" class="md-nav__link">
      Reading data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/model-evaluation/" title="Model evaluation" class="md-nav__link">
      Model evaluation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/pipelines/" title="Pipelines" class="md-nav__link">
      Pipelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/feature-extraction/" title="Feature extraction" class="md-nav__link">
      Feature extraction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/hyperparameter-tuning/" title="Hyperparameter tuning" class="md-nav__link">
      Hyperparameter tuning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/mini-batching/" title="Mini-batching" class="md-nav__link">
      Mini-batching
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API reference" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        API reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      evaluate
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="evaluate" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        <span class="md-nav__icon md-icon"></span>
        evaluate
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/evaluate/progressive-val-score/" title="progressive_val_score" class="md-nav__link">
      progressive_val_score
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      linear_model
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="linear_model" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        <span class="md-nav__icon md-icon"></span>
        linear_model
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/linear-model/LinearRegression/" title="LinearRegression" class="md-nav__link">
      LinearRegression
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      optim
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="optim" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        <span class="md-nav__icon md-icon"></span>
        optim
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/optim/Optimizer/" title="Optimizer" class="md-nav__link">
      Optimizer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4-2" type="checkbox" id="nav-3-4-2">
    
    <label class="md-nav__link" for="nav-3-4-2">
      schedulers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="schedulers" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-2">
        <span class="md-nav__icon md-icon"></span>
        schedulers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/optim/schedulers/InverseScaling/" title="InverseScaling" class="md-nav__link">
      InverseScaling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/optim/schedulers/Scheduler/" title="Scheduler" class="md-nav__link">
      Scheduler
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Examples
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Examples" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../batch-to-online/" title="From batch to online" class="md-nav__link">
      From batch to online
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bike-sharing-forecasting/" title="Bike-sharing forecasting" class="md-nav__link">
      Bike-sharing forecasting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../building-a-simple-time-series-model/" title="Building a simple time series model" class="md-nav__link">
      Building a simple time series model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../debugging-a-pipeline/" title="Debugging a pipeline" class="md-nav__link">
      Debugging a pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../imbalanced-learning/" title="Working with imbalanced data" class="md-nav__link">
      Working with imbalanced data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../matrix-factorization-for-recommender-systems-part-1/" title="Matrix Factorization for Recommender Systems - Part 1" class="md-nav__link">
      Matrix Factorization for Recommender Systems - Part 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../matrix-factorization-for-recommender-systems-part-2/" title="Matrix Factorization for Recommender Systems - Part 2" class="md-nav__link">
      Matrix Factorization for Recommender Systems - Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../matrix-factorization-for-recommender-systems-part-3/" title="Matrix Factorization for Recommender Systems - Part 3" class="md-nav__link">
      Matrix Factorization for Recommender Systems - Part 3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quantile-regression-uncertainty/" title="Handling uncertainty with quantile regression" class="md-nav__link">
      Handling uncertainty with quantile regression
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="The art of using pipelines" class="md-nav__link md-nav__link--active">
      The art of using pipelines
    </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Releases
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Releases" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.0.2/" title="0.0.2 - 2019-02-13" class="md-nav__link">
      0.0.2 - 2019-02-13
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.0.3/" title="0.0.3 - 2019-03-21" class="md-nav__link">
      0.0.3 - 2019-03-21
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.1.0/" title="0.1.0 - 2019-05-08" class="md-nav__link">
      0.1.0 - 2019-05-08
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.2.0/" title="0.2.0 - 2019-05-27" class="md-nav__link">
      0.2.0 - 2019-05-27
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.3.0/" title="0.3.0 - 2019-06-23" class="md-nav__link">
      0.3.0 - 2019-06-23
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.4.1/" title="0.4.1 - 2019-10-23" class="md-nav__link">
      0.4.1 - 2019-10-23
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.4.3/" title="0.4.3 - 2019-10-27" class="md-nav__link">
      0.4.3 - 2019-10-27
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.4.4/" title="0.4.4 - 2019-11-11" class="md-nav__link">
      0.4.4 - 2019-11-11
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.5.0/" title="0.5.0 - 2020-03-13" class="md-nav__link">
      0.5.0 - 2020-03-13
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.5.1/" title="0.5.1 - 2020-03-29" class="md-nav__link">
      0.5.1 - 2020-03-29
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.6.0/" title="0.6.0 - 2020-06-09" class="md-nav__link">
      0.6.0 - 2020-06-09
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/0.6.1/" title="0.6.1 - 2020-06-10" class="md-nav__link">
      0.6.1 - 2020-06-10
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../releases/unreleased/" title="Unreleased" class="md-nav__link">
      Unreleased
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/creme-ml/creme/edit/master/docs/examples/the-art-of-using-pipelines.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="the-art-of-using-pipelines">The art of using pipelines<a class="headerlink" href="#the-art-of-using-pipelines" title="Permanent link">&para;</a></h1>
<p>Pipelines are a natural way to think about a machine learning system. Indeed with some practice a data scientist can visualise data "flowing" through a series of steps. The input is typically some raw data which has to be processed in some manner. The goal is to represent the data in such a way that is can be ingested by a machine learning algorithm. Along the way some steps will extract features, while others will normalize the data and remove undesirable elements. Pipelines are simple, and yet they are a powerful way of designing sophisticated machine learning systems.</p>
<p>Both <a href="https://stackoverflow.com/questions/33091376/python-what-is-exactly-sklearn-pipeline-pipeline">scikit-learn</a> and <a href="https://tomaugspurger.github.io/method-chaining">pandas</a> make it possible to use pipelines. However it's quite rare to see pipelines being used in practice (at least on Kaggle). Sometimes you get to see people using scikit-learn's <code>pipeline</code> module, however the <code>pipe</code> method from <code>pandas</code> is sadly underappreciated. A big reason why pipelines are not given much love is that it's easier to think of batch learning in terms of a script or a notebook. Indeed many people doing data science seem to prefer a procedural style to a declarative style. Moreover in practice pipelines can be a bit rigid if one wishes to do non-orthodox operations.</p>
<p>Although pipelines may be a bit of an odd fit for batch learning, they make complete sense when they are used for online learning. Indeed the UNIX philosophy has advocated the use of pipelines for data processing for many decades. If you can visualise data as a stream of observations then using pipelines should make a lot of sense to you. We'll attempt to convince you by writing a machine learning algorithm in a procedural way and then converting it to a declarative pipeline in small steps. Hopefully by the end you'll be convinced, or not!</p>
<p>In this notebook we'll manipulate data from the <a href="https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting">Kaggle Recruit Restaurants Visitor Forecasting competition</a>. The data is directly available through <code>creme</code>'s <code>datasets</code> module.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">():</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">break</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>{&#39;area_name&#39;: &#39;Tōkyō-to Nerima-ku Toyotamakita&#39;,
 &#39;date&#39;: datetime.datetime(2016, 1, 1, 0, 0),
 &#39;genre_name&#39;: &#39;Izakaya&#39;,
 &#39;is_holiday&#39;: True,
 &#39;latitude&#39;: 35.7356234,
 &#39;longitude&#39;: 139.6516577,
 &#39;store_id&#39;: &#39;air_04341b588bde96cd&#39;}
10
</code></pre></div>


<p>We'll start by building and running a model using a procedural coding style. The performance of the model doesn't matter, we're simply interested in the design of the model.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">feature_extraction</span>
<span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">stats</span>


<span class="n">means</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">7</span><span class="p">)),</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">14</span><span class="p">)),</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">21</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">lin_reg</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">():</span>

    <span class="c1"># Derive date features</span>
    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;weekday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_weekend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Process the rolling means of the target  </span>
    <span class="k">for</span> <span class="n">mean</span> <span class="ow">in</span> <span class="n">means</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">mean</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
        <span class="n">mean</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Remove the key/value pairs that aren&#39;t features</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_name&#39;</span><span class="p">,</span> <span class="s1">&#39;area_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="c1"># Rescale the data</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Fit the linear regression</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">lin_reg</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">lin_reg</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Update the metric using the out-of-fold prediction</span>
    <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>MAE: 8.465114
</code></pre></div>


<p>We're not using many features. We can print the last <code>x</code> to get an idea of the features (don't forget they've been scaled!)</p>
<div class="codehilite"><pre><span></span><code><span class="n">pprint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>{&#39;is_holiday&#39;: -0.23103573677646685,
 &#39;is_weekend&#39;: 1.6249280076334165,
 &#39;target_rollingmean_14_by_store_id&#39;: -1.4125913815779154,
 &#39;target_rollingmean_21_by_store_id&#39;: -1.3980979075298519,
 &#39;target_rollingmean_7_by_store_id&#39;: -1.3502314499809096,
 &#39;weekday&#39;: 1.0292832579142892}
</code></pre></div>


<p>The above chunk of code is quite explicit but it's a bit verbose. The whole point of libraries such as <code>creme</code> is to make life easier for users. Moreover there's too much space for users to mess up the order in which things are done, which increases the chance of there being target leakage. We'll now rewrite our model in a declarative fashion using a pipeline <em>à la sklearn</em>.  </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">compose</span>


<span class="k">def</span> <span class="nf">get_date_features</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">weekday</span> <span class="o">=</span>  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;weekday&#39;</span><span class="p">:</span> <span class="n">weekday</span><span class="p">,</span> <span class="s1">&#39;is_weekend&#39;</span><span class="p">:</span> <span class="n">weekday</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">compose</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="n">compose</span><span class="o">.</span><span class="n">TransformerUnion</span><span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;date_features&#39;</span><span class="p">,</span> <span class="n">compose</span><span class="o">.</span><span class="n">FuncTransformer</span><span class="p">(</span><span class="n">get_date_features</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;last_7_mean&#39;</span><span class="p">,</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">7</span><span class="p">))),</span>
        <span class="p">(</span><span class="s1">&#39;last_14_mean&#39;</span><span class="p">,</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">14</span><span class="p">))),</span>
        <span class="p">(</span><span class="s1">&#39;last_21_mean&#39;</span><span class="p">,</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">21</span><span class="p">)))</span>
    <span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;drop_non_features&#39;</span><span class="p">,</span> <span class="n">compose</span><span class="o">.</span><span class="n">Discard</span><span class="p">(</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_name&#39;</span><span class="p">,</span> <span class="s1">&#39;area_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;lin_reg&#39;</span><span class="p">,</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">())</span>
<span class="p">)</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">():</span>

    <span class="c1"># Make a prediction without using the target</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Update the model using the target</span>
    <span class="n">model</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Update the metric using the out-of-fold prediction</span>
    <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>MAE: 8.38533
</code></pre></div>


<p>We use a <code>Pipeline</code> to arrange each step in a sequential order. A <code>TransformerUnion</code> is used to merge multiple feature extractors into a single transformer. The <code>for</code> loop is now much shorter and is thus easier to grok: we get the out-of-fold prediction, we fit the model, and finally we update the metric. This way of evaluating a model is typical of online learning, and so we put it wrapped it inside a function called <code>online_score</code> part of the <code>model_selection</code> module. We can use it to replace the <code>for</code> loop.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">creme</span> <span class="kn">import</span> <span class="n">model_selection</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">compose</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="n">compose</span><span class="o">.</span><span class="n">TransformerUnion</span><span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;date_features&#39;</span><span class="p">,</span> <span class="n">compose</span><span class="o">.</span><span class="n">FuncTransformer</span><span class="p">(</span><span class="n">get_date_features</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;last_7_mean&#39;</span><span class="p">,</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">7</span><span class="p">))),</span>
        <span class="p">(</span><span class="s1">&#39;last_14_mean&#39;</span><span class="p">,</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">14</span><span class="p">))),</span>
        <span class="p">(</span><span class="s1">&#39;last_21_mean&#39;</span><span class="p">,</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">21</span><span class="p">)))</span>
    <span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;drop_non_features&#39;</span><span class="p">,</span> <span class="n">compose</span><span class="o">.</span><span class="n">Discard</span><span class="p">(</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_name&#39;</span><span class="p">,</span> <span class="s1">&#39;area_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;lin_reg&#39;</span><span class="p">,</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">())</span>
<span class="p">)</span>

<span class="n">model_selection</span><span class="o">.</span><span class="n">progressive_val_score</span><span class="p">(</span><span class="n">X_y</span><span class="o">=</span><span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">(),</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">())</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>MAE: 8.38533
</code></pre></div>


<p>Notice that you couldn't have used the <code>online_score</code> method if you wrote the model in a procedural manner.</p>
<p>Our code is getting shorter, but it's still a bit difficult on the eyes. Indeed there is a lot of boilerplate code associated with pipelines that can get tedious to write. However <code>creme</code> has some special tricks up it's sleeve to save you from a lot of pain.</p>
<p>The first trick is that the name of each step in the pipeline can be omitted. If no name is given for a step then <code>creme</code> automatically infers one.</p>
<div class="codehilite"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">compose</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">compose</span><span class="o">.</span><span class="n">TransformerUnion</span><span class="p">(</span>
        <span class="n">compose</span><span class="o">.</span><span class="n">FuncTransformer</span><span class="p">(</span><span class="n">get_date_features</span><span class="p">),</span>
        <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">7</span><span class="p">)),</span>
        <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">14</span><span class="p">)),</span>
        <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">21</span><span class="p">))</span>
    <span class="p">),</span>
    <span class="n">compose</span><span class="o">.</span><span class="n">Discard</span><span class="p">(</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_name&#39;</span><span class="p">,</span> <span class="s1">&#39;area_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">),</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(),</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">model_selection</span><span class="o">.</span><span class="n">progressive_val_score</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">(),</span> <span class="n">model</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">())</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>MAE: 8.38533
</code></pre></div>


<p>Under the hood a <code>Pipeline</code> inherits from <code>collections.OrderedDict</code>. Indeed this makes sense because if you think about it a <code>Pipeline</code> is simply a sequence of steps where each step has a name. The reason we mention this is because it means you can manipulate a <code>Pipeline</code> the same way you would manipulate an ordinary <code>dict</code>. For instance we can print the name of each step by using the <code>keys</code> method.</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>TransformerUnion
Discard
StandardScaler
LinearRegression
</code></pre></div>


<p>The first step is a <code>FeatureUnion</code> and it's string representation contains the string representation of each of it's elements. Not having to write names saves up some time and space and is certainly less tedious.</p>
<p>The next trick is that we can use mathematical operators to compose our pipeline. For example we can use the <code>+</code> operator to merge <code>Transformer</code>s into a <code>TransformerUnion</code>. </p>
<div class="codehilite"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">compose</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">compose</span><span class="o">.</span><span class="n">FuncTransformer</span><span class="p">(</span><span class="n">get_date_features</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">21</span><span class="p">)),</span>

    <span class="n">compose</span><span class="o">.</span><span class="n">Discard</span><span class="p">(</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_name&#39;</span><span class="p">,</span> <span class="s1">&#39;area_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">),</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(),</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">model_selection</span><span class="o">.</span><span class="n">progressive_val_score</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">(),</span> <span class="n">model</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">())</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>MAE: 8.38533
</code></pre></div>


<p>Likewhise we can use the <code>|</code> operator to assemble steps into a <code>Pipeline</code>. </p>
<div class="codehilite"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">compose</span><span class="o">.</span><span class="n">FuncTransformer</span><span class="p">(</span><span class="n">get_date_features</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="mi">21</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">to_discard</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;genre_name&#39;</span><span class="p">,</span> <span class="s1">&#39;area_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="o">|</span> <span class="n">compose</span><span class="o">.</span><span class="n">Discard</span><span class="p">(</span><span class="o">*</span><span class="n">to_discard</span><span class="p">)</span> <span class="o">|</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">model</span> <span class="o">|=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>

<span class="n">model_selection</span><span class="o">.</span><span class="n">progressive_val_score</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">(),</span> <span class="n">model</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">())</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>MAE: 8.38533
</code></pre></div>


<p>Hopefully you'll agree that this is a powerful way to express machine learning pipelines. For some people this should be quite remeniscent of the UNIX pipe operator. One final trick we want to mention is that functions are automatically wrapped with a <code>FuncTransformer</code>, which can be quite handy.</p>
<div class="codehilite"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">get_date_features</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">]:</span>
    <span class="n">model</span> <span class="o">+=</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;store_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">RollingMean</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<span class="n">model</span> <span class="o">|=</span> <span class="n">compose</span><span class="o">.</span><span class="n">Discard</span><span class="p">(</span><span class="o">*</span><span class="n">to_discard</span><span class="p">)</span>
<span class="n">model</span> <span class="o">|=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">model</span> <span class="o">|=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>

<span class="n">model_selection</span><span class="o">.</span><span class="n">progressive_val_score</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">Restaurants</span><span class="p">(),</span> <span class="n">model</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">())</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>MAE: 8.38533
</code></pre></div>


<p>Naturally some may prefer the procedural style we first used because they find it easier to work with. It all depends on your style and you should use what you feel comfortable with. However we encourage you to use operators because we believe that this will increase the readability of your code, which is very important. To each their own!</p>
<p>Before finishing we can take a look at what our pipeline looks graphically.</p>
<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</code></pre></div>


<p><img alt="svg" src="../the-art-of-using-pipelines_files/the-art-of-using-pipelines_22_0.svg" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        

<!-- Application footer -->
<footer class="md-footer">

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 - 2020
          </div>
        
        Made with
        <a
          href="https://squidfunk.github.io/mkdocs-material/"
          target="_blank" rel="noopener"
        >
          Material for MkDocs
        </a>
      </div>

      <!-- Social links -->
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/creme-ml/creme" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../js/version-select.js"></script>
      
    
  </body>
</html>